# YouTube视频总结成本优化指南

## 🎯 优化目标

将YouTube视频总结的成本从**$0.1125 USD / 20次调用**降低到**约$0.03-0.05 USD / 6-8次调用**，成本降低约**60-70%**。

## 📊 原始成本分析

### 问题分析
- **总调用**: 20次
- **总Token**: 28,833
- **总成本**: $0.1125 USD
- **平均每次**: 1442 tokens

### 成本高的原因
1. **LLM调用次数过多**: 每个段落1次 + 整体总结4次
2. **重复的大量上下文**: 整体总结阶段重复发送所有分段内容
3. **分段过多**: 2-8分钟分段产生过多小段落
4. **使用昂贵模型**: 默认使用gpt-4o

## 🚀 优化策略

### 1. 减少分段数量 (减少40-60%的调用)
- **原始设置**: 2-8分钟分段，最大1000词
- **优化设置**: 4-15分钟分段，最大2000词
- **预期效果**: 段落数量从15-20个减少到6-8个

### 2. 合并整体总结LLM调用 (减少75%的调用)
- **原始方式**: 4次独立调用（主要观点、主题、结论、完整总结）
- **优化方式**: 1次合并调用，结构化输出
- **预期效果**: 4次调用合并为1次，大幅减少重复上下文

### 3. 使用更便宜的模型
- **段落总结**: 使用`gpt-4o-mini`替代`gpt-4o`
- **整体总结**: 使用`gpt-4o-mini`替代`gpt-4o`
- **成本对比**:
  - gpt-4o: $0.0025 (输入) + $0.01 (输出)
  - gpt-4o-mini: $0.00015 (输入) + $0.0006 (输出)
  - **节省**: 约85%的模型成本

### 4. 优化提示词长度
- **段落总结**: 保持详细度，调整长度控制
- **整体总结**: 结构化提示，减少重复说明

## 📈 预期优化效果

### 调用次数优化
```
原始流程: 15个段落 + 4次整体总结 = 19次调用
优化流程: 6-8个段落 + 1次整体总结 = 7-9次调用
节省: 60-65%的调用次数
```

### Token使用优化
```
原始Token: ~28,833
预期Token: ~10,000-15,000
节省: 45-65%的Token使用
```

### 成本优化
```
原始成本: $0.1125 USD
预期成本: $0.03-0.05 USD
节省: 60-70%的总成本
```

## 🛠 实施的具体优化

### 1. ProcessSegmentsControlledParallelNode优化
```typescript
// 增加分段长度
const minSegmentMinutes = shared.segmentMinutesMin || 4  // 2分钟 → 4分钟
const maxSegmentMinutes = shared.segmentMinutesMax || 15  // 8分钟 → 15分钟
maxWordsPerSegment: 2000  // 1000词 → 2000词

// 使用更便宜的模型
(prompt) => callLlm(prompt, 'gpt-4o-mini')
```

### 2. GenerateOverallSummaryNode优化
```typescript
// 将4次独立调用合并为1次结构化调用
const combinedPrompt = `基于以下视频的分段总结，请生成一个完整的视频总结报告，包含以下四个部分：
【主要主题】...
【关键要点】...
【完整总结】...
【核心结论】...`

// 使用更便宜的模型
await callLlm(combinedPrompt, 'gpt-4o-mini')
```

### 3. 默认参数优化
```typescript
// 更新流程默认参数
segmentMinutesMin: options.segmentMinutesMin || 4,  // 优化后的默认值
segmentMinutesMax: options.segmentMinutesMax || 15, // 优化后的默认值
```

## 📝 使用建议

### 1. 质量vs成本平衡
- **极致省钱**: 使用6-12分钟分段 + gpt-4o-mini
- **平衡模式**: 使用4-10分钟分段 + gpt-4o-mini (推荐)
- **高质量**: 使用3-8分钟分段 + gpt-4o

### 2. 根据视频类型调整
- **技术讲座**: 使用较长分段 (10-15分钟)
- **对话访谈**: 使用中等分段 (5-10分钟)
- **快节奏内容**: 使用较短分段 (3-6分钟)

### 3. 监控和调优
```bash
# 运行时启用token监控
yarn start --enable-token-monitoring

# 根据报告调整参数
yarn start --segment-min 5 --segment-max 12
```

## 🎉 预期最终效果

优化后的系统应该能够：
- **成本降低60-70%**
- **处理速度提升40-50%**（更少的API调用）
- **保持总结质量**（更长的段落包含更多上下文）
- **更好的用户体验**（更快完成，更低成本）

## 🔄 持续优化

1. **监控实际效果**: 使用token监控分析实际成本
2. **质量评估**: 对比优化前后的总结质量
3. **参数调优**: 根据不同视频类型微调分段参数
4. **模型升级**: 关注更新更便宜的模型选项 